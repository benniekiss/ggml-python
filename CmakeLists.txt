cmake_minimum_required(VERSION 3.15)
project(ggml-python LANGUAGES CXX)

add_subdirectory(ggml)

function(ggml_install target)
    if(NOT TARGET ${target})
        return()
    endif()

    install(
        TARGETS ${target}
        LIBRARY DESTINATION libggml/lib
        RUNTIME DESTINATION libggml/lib
        ARCHIVE DESTINATION libggml/lib
        FRAMEWORK DESTINATION libggml/lib
        RESOURCE DESTINATION libggml/lib
    )

    set_target_properties(${target} PROPERTIES
        INSTALL_RPATH "$ORIGIN"
        BUILD_WITH_INSTALL_RPATH TRUE
    )
    if(UNIX)
        if(APPLE)
            set_target_properties(${target} PROPERTIES
                INSTALL_RPATH "@loader_path"
                BUILD_WITH_INSTALL_RPATH TRUE
            )
        else()
            set_target_properties(${target} PROPERTIES
                INSTALL_RPATH "$ORIGIN"
                BUILD_WITH_INSTALL_RPATH TRUE
            )
        endif()
    endif()
endfunction()

ggml_install(ggml)
ggml_install(ggml-base)
ggml_install(ggml-amx)
ggml_install(ggml-blas)
ggml_install(ggml-can)
ggml_install(ggml-cpu)
ggml_install(ggml-cuda)
ggml_install(ggml-hip)
ggml_install(ggml-kompute)
ggml_install(ggml-metal)
ggml_install(ggml-musa)
ggml_install(ggml-rpc)
ggml_install(ggml-sycl)
ggml_install(ggml-vulkan)
